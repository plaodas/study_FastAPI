# バックアップと復元（詳細）

このドキュメントは `README.md` の「バックアップと復元」節の詳細を移動したものです。

概要
- ホストの `db/backups/latest.sql` をコンテナ内の `/backups/latest.sql` にマウントしておくと、コンテナ起動時に DB に `alembic_version` テーブルが無ければ復元を試行します。
- フルダンプの復元は環境や既存データの状態により失敗することがあるため、部分復元（特定テーブルのみ）やダンプのクリーンアップを推奨します。

コンテナでの確認手順（例: PowerShell）

```powershell
# DB コンテナに入る
docker compose -f .\compose.yaml exec -T db bash
psql -U user -d appdb
```

ヒント
- 復元でエラーが出る場合、ダンプをプレーン SQL に変換して不要な `SET` や `OWNER` 指示を削除することで成功することがあります。
- 大きなフルダンプを運用環境で自動復元するのはリスクがあるため、手動での検証を推奨します。

さらに詳しい運用手順は、必要に応じてこのファイルを拡張してください。
